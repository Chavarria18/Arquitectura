<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="es"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Controlador.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">ventas</a> &gt; <a href="index.source.html" class="el_package">com.ventas.ventas</a> &gt; <span class="el_source">Controlador.java</span></div><h1>Controlador.java</h1><pre class="source lang-java linenums">
package com.ventas.ventas;

import java.io.IOException;
import java.text.SimpleDateFormat;
import java.util.ArrayList;
import java.util.Base64;
import java.util.Date;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpSession;

import org.hibernate.annotations.Any;
import org.hibernate.cache.spi.support.AbstractReadWriteAccess.Item;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.HttpRequest;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.scheduling.annotation.Scheduled;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.ModelAttribute;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.ResponseBody;
import org.springframework.web.bind.annotation.RestController;
import org.springframework.web.client.RestTemplate;
import org.springframework.web.multipart.MultipartFile;
import org.springframework.web.servlet.ModelAndView;

//Rest
import java.util.concurrent.atomic.AtomicLong;

import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;
/**
 * &lt;p&gt;El controlador, sirve para mostrar, redireccionar las paginas web, asi como mostrar los resultados de las paginas web&lt;/p&gt;
 */
@Controller
<span class="fc" id="L47">public class Controlador {</span>
    String session2; 
    int id_session2; 
    @Autowired 
    private Correo correo; 

    @Autowired(required = true)
    private Dao dao;
    /**
     * &lt;p&gt;
     * Método para ver los dispositivos del sistema de ventas
     * &lt;/p&gt;
     * 
     * @param model   mostrar el html de los dispositivos
     * @param session sesion logeada
     * @return Se muestra la pagina html para mostrar todos los dispositivos que
     *         existen el sistema de ventas y mostrar las operaciones que puede
     *         realizar dependiento el tipo de usuario que ingrese.
     */
    @RequestMapping(&quot;/&quot;)
    public String viewHomePage(final Model model, HttpSession session) {
<span class="nc" id="L68">        final List&lt;Telefono&gt; listaDis = dao.list();</span>
<span class="nc" id="L69">        model.addAttribute(&quot;listaDis&quot;, listaDis);</span>
        //model.addAttribute(&quot;imgUtil&quot;, new ImageUtil());

<span class="nc bnc" id="L72" title="All 2 branches missed.">        if (session.getAttribute(&quot;name&quot;) == null) {</span>
<span class="nc" id="L73">            return &quot;accesoProhibido.html&quot;;</span>
        } else {
<span class="nc" id="L75">            return &quot;index.html&quot;;</span>

        }

    }

    /**
     * &lt;p&gt;
     * Método para editar el dispositivo individual
     * &lt;/p&gt;
     * 
     * @param id      para llamar el id del dispositivo
     * @param session sesion logeada
     * @return Se muestra el model con los datos de cada dispositivo individual,
     *         para que se pueda realizar una modificación y se guarde los cambios
     *         que se realizaron.
     */
    @RequestMapping(&quot;/individual/{id}&quot;)
    public ModelAndView showEditForm(@PathVariable(name = &quot;id&quot;) int id, HttpSession session) {
<span class="nc" id="L94">        ModelAndView mav = new ModelAndView(&quot;individual&quot;);</span>
<span class="nc" id="L95">        Telefono nuevo = dao.get(id);</span>
<span class="nc" id="L96">        mav.addObject(&quot;nuevo&quot;, nuevo);</span>

<span class="nc" id="L98">        return mav;</span>
    }

    /**
     * &lt;p&gt;
     * Método para mostrar el dispositivo individual
     * &lt;/p&gt;
     * 
     * @param model para mostrar la pagina del html del dispositivo individual
     * @param id    para que mande a llamar el id que tiene el dispositivo
     * @return Se muestra el html del dispositivo individual que fue seleccionado
     *         para que muestre todas sus caracteristicas y también las imagenes que
     *         tiene ese dispositivo.
     */
    @RequestMapping(value = &quot;/individual/{id}&quot;, method = RequestMethod.GET)
    public String view(final Model model, @PathVariable(&quot;id&quot;) int id) {
<span class="nc" id="L114">        final List&lt;Telefono&gt; listaDis = dao.list2(id);</span>
<span class="nc" id="L115">        final List&lt;Telefono&gt; opciones = dao.listOpciones(&quot;Select *from VENTAS.fabrica&quot;);</span>
<span class="nc" id="L116">        model.addAttribute(&quot;opciones&quot;, opciones);</span>
<span class="nc" id="L117">        model.addAttribute(&quot;listaDis&quot;, listaDis);</span>
<span class="nc" id="L118">        model.addAttribute(&quot;imgUtil&quot;, new ImageUtil());</span>
<span class="nc" id="L119">        final List&lt;Cliente&gt; listCli = dao.listaCliente();</span>
<span class="nc" id="L120">        model.addAttribute(&quot;listCli&quot;, listCli);</span>

<span class="nc" id="L122">        return &quot;individual.html&quot;;</span>
    }

    /**
     * &lt;p&gt;
     * Método para actualizar la imagen de los dispositivos individuales
     * &lt;/p&gt;
     * 
     * @param foto1   para mostrar la foto 1 del dispositivo individual
     * @param foto2   para mostrar la foto 2 del dispositivo individual
     * @param foto3   para mostrar la foto 3 del dispositivo individual
     * @param id      para que manda a llamar el id del dispositivo individual
     *                seleccionado
     * @param session para la sesion logeada
     * @return Se mostrara un model donde tendra los campos para que se pueda
     *         ingresar las imagenes de los dispositivos individuales
     */
    // Actualizar foto
    @RequestMapping(value = &quot;/updateImg&quot;, method = RequestMethod.POST)
    public String update(@RequestParam(name = &quot;foto1&quot;) MultipartFile foto1,
            @RequestParam(name = &quot;foto2&quot;) MultipartFile foto2, @RequestParam(name = &quot;foto3&quot;) MultipartFile foto3,
            @RequestParam(name = &quot;id_bodega&quot;) int id, HttpSession session) throws IOException {

      

<span class="nc" id="L147">        String tabla = &quot;Bodega&quot;;</span>
<span class="nc" id="L148">        dao.historialC(session2, &quot;Update&quot;, tabla);</span>

<span class="nc" id="L150">        return &quot;redirect:/&quot;;</span>
    }

    /**
     * &lt;p&gt;
     * Método para para insertar un dispositivo
     * &lt;/p&gt;
     * 
     * @param model para mostrar la pagina html de las caracteristicas del
     *              dispositivo
     * @return Se mostrara un html con los campos que se deberan ingresar para que
     *         se agrege un nuevo dispositivo en el sistema de ventas.
     */
    // insertar telefono
    @RequestMapping(&quot;/new&quot;)
    public String showNewForm(Model model) {
<span class="nc" id="L166">        Telefono nuevo = new Telefono();</span>
<span class="nc" id="L167">        model.addAttribute(&quot;nuevo&quot;, nuevo);</span>
<span class="nc" id="L168">        final List&lt;Telefono&gt; opciones = dao.listOpciones(&quot;Select *from VENTAS.fabrica&quot;);</span>
<span class="nc" id="L169">        model.addAttribute(&quot;opciones&quot;, opciones);</span>
<span class="nc" id="L170">        return &quot;new&quot;;</span>
    }

    /**
     * &lt;p&gt;
     * Método para guardar los datos de un dispositivo
     * &lt;/p&gt;
     * 
     * @param nuevo para guardar los datos del dispositivo
     * @return Se mostrara en el la pagia html de dispositivos el nuevo dispositivo
     *         agregado.
     */
    @RequestMapping(value = &quot;/save&quot;, method = RequestMethod.POST)
    public String save(@ModelAttribute(&quot;nuevo&quot;) Telefono nuevo) throws IOException {
<span class="nc" id="L184">        dao.save(nuevo);</span>

<span class="nc" id="L186">        String tabla = &quot;Bodega&quot;;</span>
<span class="nc" id="L187">        dao.historialC(session2, &quot;Insertar&quot;, tabla);</span>

<span class="nc" id="L189">        return &quot;redirect:/&quot;;</span>
    }

    /**
     * &lt;p&gt;
     * Método para eliminar un dispositivo
     * &lt;/p&gt;
     * 
     * @param id para llamar el id del dispositivo seleccionado
     * @return Se mostrara en el la pagia html de dispositivos sin el dispositivo
     *         que fue eliminado.
     */
    // delete telefono
    @RequestMapping(&quot;/delete/{id}&quot;)
    public String delete(@PathVariable(name = &quot;id&quot;) int id) throws IOException {
<span class="nc" id="L204">        dao.delete(id);</span>
<span class="nc" id="L205">        String tabla = &quot;Bodega&quot;;</span>
<span class="nc" id="L206">        dao.historialC(session2, &quot;Delete&quot;, tabla);</span>
<span class="nc" id="L207">        return &quot;redirect:/&quot;;</span>
    }

    /**
     * &lt;p&gt;
     * Método para actualizar un dispositivo
     * &lt;/p&gt;
     * 
     * @param nuevo para guardar los datos del dispositivo actualizados
     * @return Se mostrara en el la pagia html de dispositivos con los cambios del
     *         dispositivo.
     */
    // actualizar telefono
    @RequestMapping(value = &quot;/updatePh&quot;, method = RequestMethod.POST)
    public String updatePh(@ModelAttribute(&quot;nuevo&quot;) Telefono nuevo) throws IOException {
<span class="nc" id="L222">        dao.updateT(nuevo);</span>

<span class="nc" id="L224">        String tabla = &quot;Bodega&quot;;</span>
<span class="nc" id="L225">        dao.historialC(session2, &quot;Update&quot;, tabla);</span>
<span class="nc" id="L226">        return &quot;redirect:/&quot;;</span>

    }

    /**
     * &lt;p&gt;
     * Método para buscar un dispositivo
     * &lt;/p&gt;
     * 
     * @param model  para mostrar la pagina html del dispositivo buscado
     * @param buscar para guardar los datos del dispositivo actualizados
     * @return Se mostrara en el la pagia html donde se podra buscar el dispositivo
     *         que se necesite ingresando el parametro a buscar para que se muestre
     *         en la pagina.
     * 
     */
    // Busqueda telefono

    @RequestMapping(value = &quot;/busqueda&quot;, method = RequestMethod.GET)
    public String viewBusqueda(final Model model, @RequestParam(value = &quot;buscar&quot;, required = false) String buscar) {
<span class="nc" id="L246">        buscar = &quot;%&quot; + buscar + &quot;%&quot;;</span>
<span class="nc" id="L247">        final List&lt;Telefono&gt; listaDis = dao.listBus(buscar);</span>
<span class="nc" id="L248">        model.addAttribute(&quot;listaDis&quot;, listaDis);</span>
<span class="nc" id="L249">        model.addAttribute(&quot;imgUtil&quot;, new ImageUtil());</span>

<span class="nc" id="L251">        return &quot;busqueda.html&quot;;</span>
    }

    // clientes
    /**
     * &lt;p&gt;
     * Método para mostrar clientes
     * &lt;/p&gt;
     * 
     * @param model para mostrar la pagina html de los clientes
     * @return Se mostrara en el la pagia html todos los clientes que existen en
     *         nuestro sistema de ventas.
     * 
     */
    // read
    @RequestMapping(value = &quot;/clientes&quot;)
    public String viewcli(final Model model) {
<span class="nc" id="L268">        final List&lt;Cliente&gt; listCli = dao.listaCliente();</span>
<span class="nc" id="L269">        model.addAttribute(&quot;listCli&quot;, listCli);</span>
<span class="nc" id="L270">        return &quot;clientes.html&quot;;</span>
    }

    /**
     * &lt;p&gt;
     * Método para insertar un cliente
     * &lt;/p&gt;
     * 
     * @param model para mostrar la pagina html ingresar un cliente
     * @return Se mostrara en el la pagia html con los campos que se deben de llenar
     *         para ingresar un cliente en el sitema de ventas.
     * 
     */
    // insert
    @RequestMapping(&quot;/cliente&quot;)
    public String viewCliente(Model model) throws IOException {
<span class="nc" id="L286">        Cliente ci = new Cliente();</span>
<span class="nc" id="L287">        model.addAttribute(&quot;ci&quot;, ci);</span>
<span class="nc" id="L288">        final List&lt;Cliente&gt; opciones = dao.listOpcionesC(&quot;Select *from VENTAS.tipo_clientes&quot;);</span>
<span class="nc" id="L289">        model.addAttribute(&quot;opciones&quot;, opciones);</span>

<span class="nc" id="L291">        return &quot;cliente.html&quot;;</span>
    }

    /**
     * &lt;p&gt;
     * Método para guardar un cliente
     * &lt;/p&gt;
     * 
     * @param ci para guardar los datos de un cliente
     * @return Se mostrara en el la pagia html con el cliente que fue ingresado en
     *         el sistema.
     * 
     */
    @RequestMapping(value = &quot;/saveCliente&quot;, method = RequestMethod.POST)
    public String saveCliente(@ModelAttribute(&quot;ci&quot;) Cliente ci) throws IOException {
<span class="nc" id="L306">        dao.saveCliente(ci);</span>

<span class="nc" id="L308">        String tabla = &quot;Clientes&quot;;</span>
<span class="nc" id="L309">        dao.historialC(session2, &quot;Insertar&quot;, tabla);</span>

<span class="nc" id="L311">        return &quot;redirect:/clientes&quot;;</span>
    }

    /**
     * &lt;p&gt;
     * Método para eliminar un cliente
     * &lt;/p&gt;
     * 
     * @param id para llamar el id del cliente que fue seleccionado
     * @return Se mostrara en el la pagia html sin el cliente que fue seleccionado
     *         para eliminar del sistema.
     * 
     */
    // delete
    @RequestMapping(&quot;/deletecliente/{id}&quot;)
    public String deletecliente(@PathVariable(name = &quot;id&quot;) int id) throws IOException {
<span class="nc" id="L327">        dao.deletecliente(id);</span>

<span class="nc" id="L329">        String tabla = &quot;Clientes&quot;;</span>
<span class="nc" id="L330">        dao.historialC(session2, &quot;Delete&quot;, tabla);</span>
<span class="nc" id="L331">        return &quot;redirect:/clientes&quot;;</span>
    }

    /**
     * &lt;p&gt;
     * Método para actualizar un cliente
     * &lt;/p&gt;
     * 
     * @param id para llamar el id del cliente que fue seleccionado
     * @return Se redireccionar a la pagina html con la informacion del cliente que
     *         fue seleccionado.
     * 
     */
    // update
    @RequestMapping(&quot;/updateC/{id}&quot;)
    public ModelAndView updateC(@PathVariable(name = &quot;id&quot;) int id) {
<span class="nc" id="L347">        ModelAndView mav = new ModelAndView(&quot;updateC&quot;);</span>
<span class="nc" id="L348">        Cliente ci = dao.getC(id);</span>
<span class="nc" id="L349">        mav.addObject(&quot;ci&quot;, ci);</span>

<span class="nc" id="L351">        return mav;</span>
    }

    /**
     * &lt;p&gt;
     * Método para actualizar datos de un cliente
     * &lt;/p&gt;
     * 
     * @param model para mostrar la pagina html de actualización de un cliente
     * @param id    para llamar el id del cliente que fue seleccionado
     * @return Se mostrara en el la pagia html con los datos del cliente que se
     *         selecciono para que sea modificado.
     * 
     */
    @RequestMapping(value = &quot;/updateC/{id}&quot;, method = RequestMethod.GET)
    public String viewC2(final Model model, @PathVariable(&quot;id&quot;) int id) {
<span class="nc" id="L367">        final List&lt;Cliente&gt; listCli = dao.listaCliente2(id);</span>
<span class="nc" id="L368">        model.addAttribute(&quot;listCli&quot;, listCli);</span>
<span class="nc" id="L369">        return &quot;updateC.html&quot;;</span>
    }

    /**
     * &lt;p&gt;
     * Método para guardar los datos actualizados de un cliente
     * &lt;/p&gt;
     * 
     * @param ci para guardar los datos del cliente
     * @return Se guardaran los cambios del cliente y se mostrara por último los
     *         datos cambiados en la pagina html.
     */
    @RequestMapping(value = &quot;/updateC&quot;, method = RequestMethod.POST)
    public String updateC(@ModelAttribute(&quot;clienteN&quot;) Cliente ci) throws IOException {
<span class="nc" id="L383">        dao.updateC(ci);</span>
<span class="nc" id="L384">        String tabla = &quot;Clientes&quot;;</span>
<span class="nc" id="L385">        dao.historialC(session2, &quot;Update&quot;, tabla);</span>

<span class="nc" id="L387">        return &quot;redirect:/clientes&quot;;</span>
    }

    // Marca
    // Marca
    /**
     * &lt;p&gt;
     * Método para mostrar las marcas de los dispositivos
     * &lt;/p&gt;
     * 
     * @param model para mostrar la pagina html de marcas de dispositivos
     * @return Se mostrara en el la pagia html todas las marcas de los dispositivos
     *         que tiene el sistema de ventas.
     */
    // read
    @RequestMapping(value = &quot;/marcas&quot;)
    public String viewMar(final Model model) {
<span class="nc" id="L404">        final List&lt;Marca&gt; listMar = dao.listMarca();</span>
<span class="nc" id="L405">        model.addAttribute(&quot;listMar&quot;, listMar);</span>
<span class="nc" id="L406">        return &quot;marcas.html&quot;;</span>
    }

    /**
     * &lt;p&gt;
     * Método para insertar una marca de dispositivo
     * &lt;/p&gt;
     * 
     * @param model para mostrar la pagina html de marca
     * @return Se mostrara en el la pagia html con todos los campos para insertar
     *         una nueva marca de dispositivos.
     */
    // insert
    @RequestMapping(&quot;/addMarca&quot;)
    public String viewMarca(Model model) {
<span class="nc" id="L421">        Marca ma = new Marca();</span>
<span class="nc" id="L422">        model.addAttribute(&quot;ma&quot;, ma);</span>
<span class="nc" id="L423">        return &quot;addMarca&quot;;</span>
    }

    /**
     * &lt;p&gt;
     * Método para guardar la marca del dispositivo
     * &lt;/p&gt;
     * 
     * @param ma para guardar los datos de la marca del dispositivo
     * @return Se mostrara en el la pagia html la marca insertada del dispositivo
     *         con todos sus datos.
     */
    @RequestMapping(value = &quot;/saveMarca&quot;, method = RequestMethod.POST)
    public String saveMarca(@ModelAttribute(&quot;ma&quot;) Marca ma) throws IOException {
<span class="nc" id="L437">        dao.saveMarca(ma);</span>
<span class="nc" id="L438">        String tabla = &quot;Marcas&quot;;</span>
<span class="nc" id="L439">        dao.historialC(session2, &quot;Insert&quot;, tabla);</span>

<span class="nc" id="L441">        return &quot;redirect:/marcas&quot;;</span>
    }

    /**
     * &lt;p&gt;
     * Método para eliminar la marca del dispositivo
     * &lt;/p&gt;
     * 
     * @param id para llamar el id de la marca del dispositivo seleccionada
     * @return Se mostrara en el la pagia html sin la marca de dispositivo que fue
     *         seleccionado para eliminar del sistema.
     */
    // delete
    @RequestMapping(&quot;/deleteMarca/{id}&quot;)
    public String deleteMarca(@PathVariable(name = &quot;id&quot;) int id) throws IOException {
<span class="nc" id="L456">        dao.deleteMarca(id);</span>
<span class="nc" id="L457">        String tabla = &quot;Marcas&quot;;</span>
<span class="nc" id="L458">        dao.historialC(session2, &quot;Delete&quot;, tabla);</span>
<span class="nc" id="L459">        return &quot;redirect:/marcas&quot;;</span>
    }

    /**
     * &lt;p&gt;
     * Método para actualizar una marca de dispositivo
     * &lt;/p&gt;
     * 
     * @param modelo para mostrar la pagina html deactualizar de la marca del
     *               dispositivo
     * @param id     para llamar el id de la marca del dispositivo que fue
     *               seleccionado
     * @return Se llama a la pagina html con la informacion de la marca que fue
     *         seleccionada para modificar los campos.
     * 
     */
    // update
    @RequestMapping(value = &quot;/updateMarca/{id}&quot;, method = RequestMethod.GET)
    public String viewM(final Model model, @PathVariable(&quot;id&quot;) int id) {
<span class="nc" id="L478">        final List&lt;Marca&gt; listMar = dao.listMar2(id);</span>
<span class="nc" id="L479">        model.addAttribute(&quot;listMar&quot;, listMar);</span>
<span class="nc" id="L480">        return &quot;updateMarca.html&quot;;</span>
    }

    /**
     * &lt;p&gt;
     * Método para guardar actualizacion de una marca de dispositivo
     * &lt;/p&gt;
     * 
     * @param ma para guardar los datos modificados de la marca de dispositivos
     * @return Se llama a la pagina html de marca de dispostivo con los datos ya
     *         actualizados.
     * 
     */
    @RequestMapping(value = &quot;/updateMarca&quot;, method = RequestMethod.POST)
    public String updateMarca(@ModelAttribute(&quot;ma&quot;) Marca ma) throws IOException {
<span class="nc" id="L495">        dao.updateMarca(ma);</span>
<span class="nc" id="L496">        String tabla = &quot;Marcas&quot;;</span>
<span class="nc" id="L497">        dao.historialC(session2, &quot;Update&quot;, tabla);</span>

<span class="nc" id="L499">        return &quot;redirect:/marcas&quot;;</span>
    }

    /**
     * &lt;p&gt;
     * Método para atender a un cliente
     * &lt;/p&gt;
     * 
     * @param nit     para traer el cliente a atender
     * @param session para llamar al usuario logeado
     * @return Se llama a la pagina html para traer el nombre del cliente que sera
     *         atendido y para ver que tipo de cliente es.
     */
    // Pedido
    @RequestMapping(value = &quot;/atenderCliente&quot;, method = RequestMethod.POST)
    public String log(@RequestParam(name = &quot;nit&quot;) int nit, HttpSession session) throws IOException {
<span class="nc" id="L515">        final List&lt;Cliente&gt; listaDis = dao.clienteNit(nit);</span>

<span class="nc" id="L517">        String usuario = &quot;&quot;;</span>
<span class="nc" id="L518">        int tipo_u = 0;</span>
<span class="nc" id="L519">        int id_cliente = 0;</span>
<span class="nc bnc" id="L520" title="All 2 branches missed.">        for (Cliente cliente : listaDis) {</span>

<span class="nc" id="L522">            usuario += cliente.getNombre();</span>
<span class="nc" id="L523">            tipo_u += cliente.getId_tipo_cliente();</span>
<span class="nc" id="L524">            id_cliente += cliente.getId_cliente();</span>

<span class="nc" id="L526">        }</span>

<span class="nc bnc" id="L528" title="All 2 branches missed.">        if (listaDis.size() &gt; 0) {</span>
<span class="nc" id="L529">            session.setAttribute(&quot;nit&quot;, nit);</span>
<span class="nc" id="L530">            session.setAttribute(&quot;cliente&quot;, usuario);</span>
<span class="nc" id="L531">            session.setAttribute(&quot;idT&quot;, tipo_u);</span>
<span class="nc" id="L532">            id_session2 = id_cliente;</span>
<span class="nc" id="L533">            session.setAttribute(&quot;idc&quot;, id_cliente);</span>

<span class="nc" id="L535">            return &quot;redirect:/&quot;;</span>

        } else {
<span class="nc" id="L538">            return &quot;redirect:/&quot;;</span>
        }

    }

    /**
     * &lt;p&gt;
     * Método para hacer un pedido
     * &lt;/p&gt;
     * 
     * @param ma para insertar los pedidos
     * @return Se llama a la pagina html para insertar un pedido de los dispositivos
     *         que desea el cliente.
     */
    @RequestMapping(value = &quot;/pedido&quot;, method = RequestMethod.POST)
    public String añadirPediod(@ModelAttribute(&quot;pedidon&quot;) Pedido ma, @RequestParam(&quot;id_cliente&quot;) int id, @RequestParam(&quot;cantidadp&quot;) int times) throws IOException {

<span class="nc" id="L555">        dao.insertarPedido(ma);</span>
<span class="nc" id="L556">        String tabla = &quot;Pedido&quot;;</span>
<span class="nc" id="L557">        dao.asignarNum(id,times);</span>
<span class="nc" id="L558">        dao.historialC(session2, &quot;Insert&quot;, tabla);</span>

<span class="nc" id="L560">        return &quot;redirect:/&quot;;</span>
    }

    /**
     * &lt;p&gt;
     * Método para mostrar los pedidos
     * &lt;/p&gt;
     * 
     * @param model para mostrar los pedidos del cliente
     * @return Se llama a la pagina html para que muestre todos los pedidos de los
     *         dispositivos que hizo un cliente.
     */
    @RequestMapping(&quot;/carro&quot;)
    public String carro(final Model model) {
<span class="nc" id="L574">        final List&lt;Pedido&gt; listC = dao.mostrarCarro(id_session2);</span>
<span class="nc" id="L575">        model.addAttribute(&quot;listC&quot;, listC);</span>

<span class="nc" id="L577">        return &quot;carro.html&quot;;</span>
    }

    /**
     * &lt;p&gt;
     * Método para efectuar pago de pedidos al credito
     * &lt;/p&gt;
     * 
     * @param model para mostrar si es pedido al credito
     * @param cerd  para seleccionar pedido al cedito
     * @return Se llama a la pagina html para poder seleccionar la facturación del
     *         pedido es al credito.
     */
    @RequestMapping(value = &quot;/facturar&quot;, method = RequestMethod.POST)
    public String factura(final Model model, @RequestParam(&quot;credito&quot;) int cred) {

<span class="nc" id="L593">        dao.facturar(id_session2, cred);</span>

<span class="nc" id="L595">        return &quot;redirect:/factura&quot;;</span>
    }

    /**
     * &lt;p&gt;
     * Método para facturacion de pedido
     * &lt;/p&gt;
     * 
     * @param model para mostrar la factura de los dispositivos comprados
     * @return Se llama a la pagina html para mostrar los datos para la facturacion
     *         de la compra de los pedidos de un cliente.
     */
    @RequestMapping(&quot;/factura&quot;)
    public String factura(final Model model) {

<span class="nc" id="L610">        final List&lt;Pedido&gt; listaF = dao.mostrarFactura(id_session2);</span>
<span class="nc" id="L611">        model.addAttribute(&quot;listaF&quot;, listaF);</span>
<span class="nc" id="L612">        final List&lt;Pedido&gt; listaT = dao.total(id_session2);</span>
<span class="nc" id="L613">        model.addAttribute(&quot;listaT&quot;, listaT);</span>

<span class="nc" id="L615">        return &quot;factura.html&quot;;</span>
    }

    /**
     * &lt;p&gt;
     * Método para eliminar un pedido del cliente
     * &lt;/p&gt;
     * 
     * @param id para llamar el id del pedido del cliente
     * @return Se llama el id del pedido del cliente para que se elimine del carrito
     *         de compras.
     */
    @RequestMapping(value = &quot;/eliminarPedido&quot;, method = RequestMethod.POST)
    public String deleteP(@RequestParam(name = &quot;id_pedido&quot;) int id) {

<span class="nc" id="L630">        dao.deletePedido(id);</span>
        ;
<span class="nc" id="L632">        return &quot;redirect:/carro&quot;;</span>
    }

    /**
     * &lt;p&gt;
     * Método para verificar tipo de cliente y descuento
     * &lt;/p&gt;
     * 
     * @param id para llamar el id del cliente que esta comprando
     * @return Se llama el id del cliente que esta comprando un dispositivo para
     *         poder generar un descuento dependiendo que tipo de cliente es el que
     *         esta comprando.
     */
    @RequestMapping(value = &quot;/comprarT&quot;, method = RequestMethod.POST)
    public String comprarT(@RequestParam(name = &quot;id_cliente&quot;) int id) {

<span class="nc" id="L648">        dao.comprarT(id);</span>
  
<span class="nc" id="L650">        return &quot;redirect:/carro&quot;;</span>
    }

    // MANEJO DE USUARIOS
    // Login de usuarios
    /**
     * &lt;p&gt;
     * Método para logearse en el sistema de ventas
     * &lt;/p&gt;
     * 
     * @param model   para mostrar la pagina del html
     * @param session sesion para logearse
     * @return Se muestra el html de iniciar sesion para que el usuario se logee por
     *         medio de nombre y contraseña, se revisa si el usuario existe dejará
     *         ingresar y mostrara los dispositivos y en caso de que el usuario no
     *         existe no se podra logear y aparecera que el acceso es denegado.
     */
    @RequestMapping(&quot;/login&quot;)
    public String verLogin(final Model model, HttpSession session) {
<span class="nc" id="L669">        session.invalidate();</span>
<span class="nc" id="L670">        return &quot;login.html&quot;;</span>
    }

    /**
     * &lt;p&gt;
     * Método para verificación de usuarios
     * &lt;/p&gt;
     * 
     * @param usuarion   usuario que se ingresa
     * @param contraseña contraseña que se ingresa
     * @param session    sesion para logearse
     * @return Se manda el parametro de usuario y contraseña para que el sistema
     *         peuda validar si existe el usuario y que tipo de usuario es el que
     *         ingresara al sistema. Si no se encuentra el usuario dara una alerta
     *         de accesos denegado.
     */
    @RequestMapping(value = &quot;/log&quot;, method = RequestMethod.POST)
    public String log(@RequestParam(name = &quot;usuario&quot;) String usuarion,
            @RequestParam(name = &quot;contraseña&quot;) String contraseña, HttpSession session) throws IOException {
<span class="nc" id="L689">        final List&lt;Usuarios&gt; listaDis = dao.listUsuarios(usuarion, contraseña);</span>

<span class="nc" id="L691">        int tipo = 0;</span>
<span class="nc bnc" id="L692" title="All 2 branches missed.">        for (Usuarios usuarios : listaDis) {</span>

<span class="nc" id="L694">            tipo += usuarios.getId_tipo_usuario();</span>
<span class="nc" id="L695">        }</span>

<span class="nc bnc" id="L697" title="All 2 branches missed.">        if (listaDis.size() &gt; 0) {</span>
<span class="nc" id="L698">            session.setAttribute(&quot;name&quot;, usuarion);</span>
<span class="nc" id="L699">            session2 = usuarion;</span>
<span class="nc" id="L700">            session.setAttribute(&quot;tipo&quot;, tipo);</span>

<span class="nc" id="L702">            return &quot;redirect:/&quot;;</span>

        } else {
<span class="nc" id="L705">            return &quot;redirect:/login?error=true&quot;;</span>
        }

    }

    /**
     * &lt;p&gt;
     * Método para verificación de usuarios
     * &lt;/p&gt;
     * 
     * @param usuarion   usuario que se ingresa
     * @param contraseña contraseña que se ingresa
     * @param session    sesion para logearse
     * @return Se manda el parametro de usuario y contraseña para que el sistema
     *         peuda validar si existe el usuario y que tipo de usuario es el que
     *         ingresara al sistema. Si no se encuentra el usuario dara una alerta
     *         de accesos denegado.
     */
    // Error
    /**
     * &lt;p&gt;
     * Método para mostrar error en el login
     * &lt;/p&gt;
     * 
     * @param model para mostrar el html
     * @param error para mostrar error en el html
     * @return Se retornara en la pagina html del login si existe un error a la hora
     *         de ingresar al sistema de ventas.
     */
    @RequestMapping(&quot;/login?{error}&quot;)
    public String verLoginE(final Model model, @PathVariable(&quot;error&quot;) String error) {

<span class="nc" id="L737">        return &quot;login.html&quot;;</span>
    }

    /**
     * &lt;p&gt;
     * Método para restingir el acceso a las paginas html
     * 
     * @param model para mostrar el html
     * @return Se retornara en la pagina html diciendo que tiene acceso prohibido a
     *         esa pagina ya que no es un usuario permitido.
     */
    @RequestMapping(&quot;/accesoProhibido&quot;)
    public String accesoP(final Model model) {

<span class="nc" id="L751">        return &quot;accesoProhibido.html&quot;;</span>
    }

    // Pagina usuarios
    /**
     * &lt;p&gt;
     * Método para mostrar los usuarios
     * 
     * @param model para mostrar el html de usuarios
     * @return Se retornara en la pagina html todos los usuarios que existen en el
     *         sistema de ventas.
     */
    @RequestMapping(value = &quot;/usuarios&quot;)
    public String usuariosPag(final Model model) {
<span class="nc" id="L765">        final List&lt;Usuarios&gt; listU = dao.usuariosMostrar();</span>
<span class="nc" id="L766">        model.addAttribute(&quot;listU&quot;, listU);</span>
<span class="nc" id="L767">        return &quot;usuarios.html&quot;;</span>
    }

    /**
     * &lt;p&gt;
     * Método para actualizar un usuario
     * 
     * @param nuevo para mandar los usuarios actualizados
     * @return Se mandaran los datos del usuario que se estan actualizando en el
     *         sistema.
     */
    @RequestMapping(value = &quot;/updateUsuario&quot;, method = RequestMethod.POST)
    public String actualizarU(@ModelAttribute(&quot;user&quot;) Usuarios nuevo) throws IOException {

<span class="nc" id="L781">        dao.updateU(nuevo);</span>
<span class="nc" id="L782">        String tabla = &quot;Usuarios&quot;;</span>
<span class="nc" id="L783">        dao.historialC(session2, &quot;Update&quot;, tabla);</span>
<span class="nc" id="L784">        return &quot;redirect:/usuarios&quot;;</span>
    }

    /**
     * &lt;p&gt;
     * Método para eliminar un usuario
     * 
     * @param id para llamar el id del usuario que se selecciono
     * @return Se mandaran la operacion de eliminacion del usuario que fue
     *         seleccionado y se redireccionara a la pagina de usuarios ya con el
     *         usuario eliminado.
     */
    @RequestMapping(value = &quot;/eliminarUsuario&quot;, method = RequestMethod.POST)
    public String deleteU(@RequestParam(name = &quot;id_usuario&quot;) int id) throws IOException {

<span class="nc" id="L799">        dao.deleteUsuario(id);</span>
<span class="nc" id="L800">        String tabla = &quot;Usuarios&quot;;</span>
<span class="nc" id="L801">        dao.historialC(session2, &quot;Delete&quot;, tabla);</span>
<span class="nc" id="L802">        return &quot;redirect:/usuarios&quot;;</span>
    }

    /**
     * &lt;p&gt;
     * Método para salir del sistema
     * 
     * @param model   para mostrar el html
     * @param session para llamar a la sesion logeada
     * @return Se mandaran la pagina html del login cuando el usuario se deslogee
     *         del sistema de ventas.
     */
    @RequestMapping(&quot;/logoff&quot;)
    public String logoff(final Model model, HttpSession session) {
<span class="nc" id="L816">        session.invalidate();</span>
<span class="nc" id="L817">        return &quot;login.html&quot;;</span>
    }

    // Crear usuario
    /**
     * &lt;p&gt;
     * Método para insertar un usuario
     * 
     * @param nuevo para insertar un usuario
     * @return Se mandaran la pagina html donde se podra ingresar un nuevo ussuario
     *         al sistema de ventas para que tenga sus respectivos accesos.
     */
    @RequestMapping(value = &quot;/crearUsuario&quot;, method = RequestMethod.POST)
    public String createU(@ModelAttribute(&quot;userN&quot;) Usuarios nuevo) throws IOException {

<span class="nc" id="L832">        Base64.getEncoder().encodeToString(nuevo.getContraseña().getBytes(&quot;utf-8&quot;));</span>
<span class="nc" id="L833">        dao.crearU(nuevo);</span>
<span class="nc" id="L834">        String tabla = &quot;Usuarios&quot;;</span>
<span class="nc" id="L835">        dao.historialC(session2, &quot;Insert&quot;, tabla);</span>
<span class="nc" id="L836">        return &quot;redirect:/usuarios&quot;;</span>
    }

    // Mostrar historial
    /**
     * &lt;p&gt;
     * Método para ver historial de log
     * 
     * @param model para mostrar el html
     * @return Se mandaran la pagina html del historial de todas las operaciones que
     *         se han realizado en el sistema de ventas.
     */
    @RequestMapping(value = &quot;/cambios&quot;)
    public String cambiosP(final Model model) {
<span class="nc" id="L850">        final List&lt;Historial&gt; listC = dao.cambios();</span>
<span class="nc" id="L851">        model.addAttribute(&quot;listC&quot;, listC);</span>
<span class="nc" id="L852">        return &quot;cambios.html&quot;;</span>
    }

    // Borrar historial
    /**
     * &lt;p&gt;
     * Método para eliminar historial de log
     * &lt;/p&gt;
     * 
     * @return Se eliminara todo el historial de las operaciones que se realizaron
     *         en el sistema de ventas.
     */
    @RequestMapping(&quot;/eliminarH&quot;)
    public String eliminarhistorial() throws IOException {
<span class="nc" id="L866">        dao.historialBorrar();</span>
<span class="nc" id="L867">        dao.historialC(session2, &quot;Elimino historial&quot;, &quot;Historial&quot;);</span>
<span class="nc" id="L868">        return &quot;redirect:/cambios&quot;;</span>
    }

    // Dispositivos individuales
    /**
     * &lt;p&gt;
     * Método para mostrar los dispositvos individuales
     * &lt;/p&gt;
     * 
     * 
     * @param model para mostrar el html
     * @return Se mostrara la pagina html con los dato de los dispositivos
     *         individuales con su numero de serie.
     */
    @RequestMapping(value = &quot;/terminales&quot;)
    public String terminales(final Model model) {
<span class="nc" id="L884">        final List&lt;Telefono&gt; listT = dao.listTerminales();</span>
<span class="nc" id="L885">        model.addAttribute(&quot;listT&quot;, listT);</span>
<span class="nc" id="L886">        return &quot;terminales.html&quot;;</span>
    }

    // Bodega
    /**
     * &lt;p&gt;
     * Método para mostrar los dispositvos en bodega
     * &lt;/p&gt;
     * 
     * 
     * @param model para mostrar el html
     * @return Se mostrara la pagina html con los dispositivos en existencia en
     *         bodegas en el sistema de ventas.
     */
    @RequestMapping(value = &quot;/bodega&quot;)
    public String bodega(final Model model) {
<span class="nc" id="L902">        final List&lt;Telefono&gt; listT = dao.bodega();</span>
<span class="nc" id="L903">        model.addAttribute(&quot;listT&quot;, listT);</span>
<span class="nc" id="L904">        return &quot;bodega.html&quot;;</span>
    }

    /**
     * &lt;p&gt;
     * Método para eliminar los dispositvos en bodega
     * &lt;/p&gt;
     * 
     * @param id para llamar el id de los dispositivos que se selecciono
     * @return Se eliminara de bodegas los dispositivo que ya no estara en el
     *         sistema de ventas.
     */
    @RequestMapping(&quot;/eliminarT&quot;)
    public String eliminarB(@RequestParam(name = &quot;id_bodega&quot;) int id) throws IOException {
<span class="nc" id="L918">        dao.deleteT(id);</span>
<span class="nc" id="L919">        dao.historialC(session2, &quot;Delete&quot;, &quot;Bodega&quot;);</span>
<span class="nc" id="L920">        return &quot;redirect:/bodega&quot;;</span>
    }

    // Mostrar compras individuales
    /**
     * &lt;p&gt;
     * Método para compras individuales
     * &lt;/p&gt;
     * 
     * @param model para mostrar el html
     * @param id    para llamar el id de los clientes individuales
     * @return Se tendra en la pagina html de compras los dispositivos de un cliente
     *         individual que fueron comprados.
     */
    @RequestMapping(value = &quot;/compras/{id}&quot;, method = RequestMethod.GET)
    public String viewCompra(final Model model, @PathVariable(&quot;id&quot;) int id) {
<span class="nc" id="L936">        final List&lt;Pedido&gt; listC = dao.mostrarC(id);</span>
<span class="nc" id="L937">        model.addAttribute(&quot;listC&quot;, listC);</span>
<span class="nc" id="L938">        final List&lt;Pedido&gt; listaT = dao.total2(id);</span>
<span class="nc" id="L939">        model.addAttribute(&quot;listaT&quot;, listaT);</span>
<span class="nc" id="L940">        return &quot;compras.html&quot;;</span>
    }

    /**
     * &lt;p&gt;
     * Método para enviar correo de compras al credito
     * &lt;/p&gt;
     * 
     * @param model   para mostrar el html
     * @param id      para llamar de clientes
     * @param correoE para mandar los datos de compra al credito
     * @return Se tendra una pagina web donde se enviara un correo a los clientes
     *         que compraron dispositivos al credito para recordarles de su pago.
     */
    @RequestMapping(value = &quot;/reporte/{id}/{correo}&quot;, method = RequestMethod.GET)
    public String reporte(final Model model, @PathVariable(&quot;id&quot;) int id, @PathVariable(&quot;correo&quot;) String correoE) {
<span class="nc" id="L956">        final List&lt;Pedido&gt; listC = dao.mostrarC(id);</span>
<span class="nc" id="L957">        model.addAttribute(&quot;listC&quot;, listC);</span>
<span class="nc" id="L958">        final List&lt;Pedido&gt; listaT = dao.total2(id);</span>
<span class="nc" id="L959">        model.addAttribute(&quot;listaT&quot;, listaT);</span>

<span class="nc" id="L961">        String mensaje = &quot;Los dispositvos comprados este mes fueron: &quot;;</span>
<span class="nc" id="L962">        String mensajeT = &quot; '\n'El total de compras al credito es de: &quot;;</span>

<span class="nc bnc" id="L964" title="All 2 branches missed.">        for (Pedido pedido : listaT) {</span>
<span class="nc" id="L965">            mensajeT += pedido.getTotales();</span>
<span class="nc" id="L966">        }</span>
<span class="nc bnc" id="L967" title="All 2 branches missed.">        for (Pedido pedido : listC) {</span>
<span class="nc" id="L968">            mensaje += pedido.getNombret() + ',' + pedido.getCantidadp() + pedido.getCantidadp_a() + ',';</span>
<span class="nc" id="L969">        }</span>

<span class="nc" id="L971">        correo.sendMail(&quot;marcellinos777@gmail.com&quot;, correoE, &quot;Detalle&quot;, mensaje + mensajeT);</span>
<span class="nc" id="L972">        return &quot;compras.html&quot;;</span>
    }

    // Mostrar el board
    /**
     * &lt;p&gt;
     * Método para mostrar las marcas vendidas
     * &lt;/p&gt;
     * 
     * @param model para mostrar el html
     * @return Se tendra una pagina web donde se mostraran unas graficas con las
     *         marcas que fueron vendidas y cuantos dispositivos fueron vendidos en
     *         el sistema de ventas.
     */
    @RequestMapping(value = &quot;/board&quot;)
    public String board(final Model model) {
<span class="nc" id="L988">        final List&lt;Pedido&gt; listT = dao.board();</span>
<span class="nc" id="L989">        model.addAttribute(&quot;listT&quot;, listT);</span>

<span class="nc" id="L991">        List&lt;String&gt; marcas = new ArrayList&lt;String&gt;();</span>
<span class="nc" id="L992">        List&lt;Integer&gt; cantidad = new ArrayList&lt;Integer&gt;();</span>

<span class="nc bnc" id="L994" title="All 2 branches missed.">        for (Pedido cuenta : listT) {</span>
<span class="nc" id="L995">            String nmarca = cuenta.getNombref();</span>
<span class="nc" id="L996">            marcas.add(nmarca);</span>
<span class="nc" id="L997">            cantidad.add(cuenta.getCantidad());</span>
<span class="nc" id="L998">        }</span>
<span class="nc" id="L999">        cantidad.add(0);</span>
<span class="nc" id="L1000">        model.addAttribute(&quot;marcas&quot;, marcas);</span>
<span class="nc" id="L1001">        model.addAttribute(&quot;cantidad&quot;, cantidad);</span>

<span class="nc" id="L1003">        return &quot;board.html&quot;;</span>
    }

    // REST
    /**
     * &lt;p&gt;
     * Método para mostrar los dispositvos de fabrica
     * &lt;/p&gt;
     * 
     * @param model para mostrar el html
     * @return Se tendra una pagina web donde se mostraran los dispositivos que
     *         venden la fabrica de alguna marca en especifico.
     */
    @RequestMapping(value = &quot;/getdispo&quot;, method = RequestMethod.GET)
    public String getDispo(final Model model) {
<span class="nc" id="L1018">        String uri = &quot;http://localhost:5000/api/dispositivos&quot;;</span>
<span class="nc" id="L1019">        RestTemplate restTemplate = new RestTemplate();</span>

<span class="nc" id="L1021">        ResponseEntity&lt;Dispositivo[]&gt; response = restTemplate.getForEntity(uri, Dispositivo[].class);</span>
<span class="nc" id="L1022">        Dispositivo[] employees = response.getBody();</span>
<span class="nc" id="L1023">        model.addAttribute(&quot;listaFD&quot;, employees);</span>
<span class="nc" id="L1024">        Telefono nuevo = new Telefono();</span>
<span class="nc" id="L1025">        model.addAttribute(&quot;nuevo&quot;, nuevo);</span>

<span class="nc" id="L1027">        return &quot;AAFabricaDispo.html&quot;;</span>
    }

    // Ir a fabrica
    /**
     * &lt;p&gt;
     * Método para insertar fabrica
     * &lt;/p&gt;
     * 
     * @param model para mostrar el html
     * @return Se tendra una pagina web para ingresar una nueva fabrica donde el
     *         sistema de ventas podra realizar compras.
     */
    @RequestMapping(value = &quot;/fabricas&quot;)
    public String fabricas(final Model model) {
<span class="nc" id="L1042">        Fabrica nuevo = new Fabrica();</span>
<span class="nc" id="L1043">        model.addAttribute(&quot;nuevo&quot;, nuevo);</span>
<span class="nc" id="L1044">        final List&lt;Fabrica&gt; listaDis = dao.listFabrica();</span>
<span class="nc" id="L1045">        model.addAttribute(&quot;listaF&quot;, listaDis);</span>

<span class="nc" id="L1047">        return &quot;Fabrica.html&quot;;</span>
    }

    // Guardar fabrica
    /**
     * &lt;p&gt;
     * Método para guardar fabrica
     * &lt;/p&gt;
     * 
     * @param nuevo para guardar los datos de la fabrica
     * @param model para mostrar el html
     * @return Se tendra una pagina web donde se guardaran las fabricas con las
     *         cuales el sistema de ventas puede interactuar.
     */
    @RequestMapping(value = &quot;/guardarFabrica&quot;, method = RequestMethod.POST)
    public String guardarFabri(final Model model, @ModelAttribute(&quot;nuevo&quot;) Fabrica nuevo) throws IOException {
<span class="nc" id="L1063">        dao.guardarFabrica(nuevo);</span>
<span class="nc" id="L1064">        Marca ma = new Marca();</span>

<span class="nc" id="L1066">        ma.setNombre_marca(nuevo.getNombref());</span>
<span class="nc" id="L1067">        dao.saveMarca(ma);</span>

<span class="nc" id="L1069">        return &quot;redirect:/fabricas&quot;;</span>
    }

<span class="fc" id="L1072">    String ip = &quot;&quot;;</span>
<span class="fc" id="L1073">    String puerto = &quot;&quot;;</span>
<span class="fc" id="L1074">    String url = &quot;&quot;;</span>

    // Conectar con fabrica
    /**
     * &lt;p&gt;
     * Método para conectar con una fabrica
     * &lt;/p&gt;
     * 
     * @param model para mostrar el html
     * @param id    para llamar el id de la fabrica
     * @return Se tendra una pagina web donde se conectara las fabricas para poder
     *         realizar un pedido.
     */
    @RequestMapping(value = &quot;/irFabrica/{id}&quot;, method = RequestMethod.GET)
    public String irFabrica(final Model model, @PathVariable(&quot;id&quot;) int id) {

<span class="nc" id="L1090">        final List&lt;Fabrica&gt; listaF = dao.getFab(id);</span>

<span class="nc bnc" id="L1092" title="All 2 branches missed.">        for (Fabrica fabrica : listaF) {</span>
<span class="nc" id="L1093">            ip = fabrica.getIp();</span>
<span class="nc" id="L1094">            puerto = fabrica.getPuerto();</span>

<span class="nc" id="L1096">        }</span>

<span class="nc" id="L1098">        final List&lt;Fabrica&gt; listaF2 = dao.getFab(id);</span>
<span class="nc" id="L1099">        int idmarca = 0;</span>
<span class="nc bnc" id="L1100" title="All 2 branches missed.">        for (Fabrica fabrica : listaF2) {</span>
<span class="nc" id="L1101">            idmarca += fabrica.getId_fabrica();</span>
<span class="nc" id="L1102">        }</span>
<span class="nc" id="L1103">        model.addAttribute(&quot;id_marca&quot;, idmarca);</span>

        // Para mostrar los dispositivos
<span class="nc" id="L1106">        String uri = &quot;http://&quot; + ip + &quot;:&quot; + puerto + &quot;/api/dispositivos&quot;;</span>
<span class="nc" id="L1107">        url = uri;</span>
<span class="nc" id="L1108">        RestTemplate restTemplate = new RestTemplate();</span>
<span class="nc" id="L1109">        ResponseEntity&lt;Telefono[]&gt; response = restTemplate.getForEntity(uri, Telefono[].class);</span>
<span class="nc" id="L1110">        Telefono[] employees = response.getBody();</span>
<span class="nc" id="L1111">        model.addAttribute(&quot;listaFD&quot;, employees);</span>
        // Para mostrar los clientes
<span class="nc" id="L1113">        String uri2 = &quot;http://&quot; + ip + &quot;:&quot; + puerto + &quot;/api/cliente&quot;;</span>
<span class="nc" id="L1114">        RestTemplate restTemplate2 = new RestTemplate();</span>
<span class="nc" id="L1115">        ResponseEntity&lt;Cliente[]&gt; response2 = restTemplate2.getForEntity(uri2, Cliente[].class);</span>
<span class="nc" id="L1116">        Cliente[] clientes = response2.getBody();</span>
<span class="nc" id="L1117">        model.addAttribute(&quot;listaC&quot;, clientes);</span>

<span class="nc" id="L1119">        Telefono nuevo = new Telefono();</span>
<span class="nc" id="L1120">        model.addAttribute(&quot;nuevo&quot;, nuevo);</span>

<span class="nc" id="L1122">        return &quot;AAFabricaDispo.html&quot;;</span>
    }


    /**
     * &lt;p&gt;
     * Método para eliminar una fabrica
     * &lt;/p&gt;
     * 
     * @param id para llamar el id de la fabrica
     * @return se enviara el parametro del id de la fabrica la cual fue seleccionada
     *         para eliminarla y redireccionara a la pagina de las fabricas sin la
     *         que fue eliminada.
     */
    @RequestMapping(value = &quot;/deletefab&quot;, method = RequestMethod.POST)
    public String deletefab(@RequestParam(name = &quot;id_fabrica&quot;) int id) throws IOException {
<span class="nc" id="L1138">        dao.deletefab(id);</span>

<span class="nc" id="L1140">        String tabla = &quot;Fabrica&quot;;</span>
<span class="nc" id="L1141">        dao.historialC(session2, &quot;Delete&quot;, tabla);</span>
<span class="nc" id="L1142">        return &quot;redirect:/fabricas&quot;;</span>
    }

    

    
      
    //TODO:Cambio   


       /**
         * &lt;p&gt;Este controlador es para hacer un pedidos al sistema de fabrica&lt;/p&gt;
         * @param nuevo el telefono a pedir
         * @param idu   el id del usuario que lo pidio
         * @param idd   el id de la terminal a pedir
         * @return la pagina a redireccionar 
      
        */    
        @RequestMapping(value = &quot;/savePD&quot;, method = RequestMethod.POST)
        public String savep(@ModelAttribute(&quot;nuevo&quot;) Telefono nuevo,@RequestParam(name=&quot;idu&quot;) String idu,@RequestParam(name=&quot;_idd&quot;) String idd)
                throws IOException {
            
            //dao.save(nuevo);

<span class="nc" id="L1166">            String uri = &quot;http://&quot; + ip +&quot;:&quot;+ puerto+ &quot;/api/pedidos/gios&quot;;</span>
<span class="nc" id="L1167">		    RestTemplate restTemplate = new RestTemplate();</span>

<span class="nc" id="L1169">		    Map&lt;String, String&gt; map = new HashMap&lt;&gt;();</span>
<span class="nc" id="L1170">            Date fecha = new Date(); </span>
<span class="nc" id="L1171">            SimpleDateFormat sdf = new SimpleDateFormat(&quot;yyyy/MM/dd&quot;);</span>
<span class="nc" id="L1172">            String f = sdf.format(new Date());</span>

<span class="nc" id="L1174">            map.put(&quot;cantidad&quot;, String.valueOf(nuevo.getExistencia()));          </span>
<span class="nc" id="L1175">            map.put(&quot;fecha_p&quot;, f); </span>
<span class="nc" id="L1176">            map.put(&quot;dispositivo&quot;,idd);</span>
<span class="nc" id="L1177">            map.put(&quot;cliente&quot;,idu);              </span>
           
			  
<span class="nc" id="L1180">		    ResponseEntity&lt;Void&gt; response  = restTemplate.postForEntity(uri, map, Void.class);</span>
		
<span class="nc bnc" id="L1182" title="All 2 branches missed.">		if (response.getStatusCode() == HttpStatus.OK) {</span>
<span class="nc" id="L1183">			System.out.println(&quot;Request Successful&quot;);</span>
		} else {
<span class="nc" id="L1185">			System.out.println(&quot;Request Failed&quot;);</span>
		}
<span class="nc" id="L1187">		return &quot;redirect:/&quot;;</span>
            
    
    
        }

     



        /**
         * &lt;p&gt;Este controlador es para confirmar el pediod a fabrica&lt;/p&gt;
         * @param nuevo el telefono a confirmar 
         * @param idu   el id del usuario que lo confirmo 
         * @param idd   el id de la terminal a confirmar 
         * @param idp   el id del pedido a confirmar 
         * @return la pagina a redireccionar 
      
        */ 
        @RequestMapping(value = &quot;/savePD2&quot;)
        public String save2(@ModelAttribute(&quot;nuevo&quot;) Telefono nuevo,@RequestParam(name=&quot;idu&quot;) String idu,@RequestParam(name=&quot;_idd&quot;) String idd,@RequestParam(name=&quot;_idp&quot;) String idp,@RequestParam(name=&quot;listanum&quot;) List&lt;String&gt; num)
                throws IOException {
            
           
<span class="nc" id="L1211">                dao.save(nuevo);</span>
<span class="nc bnc" id="L1212" title="All 2 branches missed.">                    for (String string : num) {</span>
<span class="nc" id="L1213">                        String[] parts = string.split(&quot;/&quot;);</span>
<span class="nc bnc" id="L1214" title="All 2 branches missed.">                        if(!string.equals(&quot;1&quot;)){</span>
                            
<span class="nc" id="L1216">                            dao.saveNum(string,parts[0],dao.getlastID().getId_bodega());</span>
                            
                        }
                        
<span class="nc" id="L1220">                    }</span>
  

        

<span class="nc" id="L1225">            String uri = &quot;http://&quot; + ip +&quot;:&quot;+ puerto+ &quot;/api/pedidos/&quot; + idp;</span>
<span class="nc" id="L1226">		    RestTemplate restTemplate = new RestTemplate();</span>
<span class="nc" id="L1227">		    Map&lt;String, String&gt; map = new HashMap&lt;&gt;();       </span>
<span class="nc" id="L1228">            map.put(&quot;estado&quot;,&quot;Entregado&quot;);        </span>
  
           	
		  
<span class="nc" id="L1232">           Telefono wry = new Telefono();</span>
<span class="nc" id="L1233">           wry.setEstado(&quot;Entregado&quot;);</span>
            
		  

<span class="nc" id="L1237">		   restTemplate.put(uri, map);  </span>

           
		
<span class="nc" id="L1241">		return &quot;redirect:/&quot;;</span>
            
    
    
        }

    

         /**
         * &lt;p&gt;Este controlador es para visualizar los pedidos realizados a cada fabrica &lt;/p&gt;
         * @param model la representacion html 
         * @param id el id de la fabrica a consultar los pedidos       
         * @return la pagina a redireccionar 
      
        */        
        @RequestMapping(value = &quot;/pedidosF/{id}&quot;,method = RequestMethod.GET)
        public String   getPedidoF(final Model model,@PathVariable(&quot;id&quot;) int id)

        {

<span class="nc" id="L1261">            final List&lt;Fabrica&gt; listaF = dao.getFab(id); </span>
        
<span class="nc bnc" id="L1263" title="All 2 branches missed.">                for (Fabrica fabrica : listaF) {</span>
<span class="nc" id="L1264">                ip = fabrica.getIp();</span>
<span class="nc" id="L1265">                puerto = fabrica.getPuerto(); </span>
            
<span class="nc" id="L1267">                }</span>
<span class="nc" id="L1268">            final List&lt;Fabrica&gt; listaF2 = dao.getFab(id); </span>
<span class="nc" id="L1269">            int idmarca = 0; </span>
<span class="nc bnc" id="L1270" title="All 2 branches missed.">            for (Fabrica fabrica : listaF2) {</span>
<span class="nc" id="L1271">                idmarca += fabrica.getId_fabrica();</span>
<span class="nc" id="L1272">            }</span>
<span class="nc" id="L1273">            model.addAttribute(&quot;id_marca&quot;, idmarca);</span>
<span class="nc" id="L1274">            String con = ip +&quot;:&quot; + puerto; </span>
<span class="nc" id="L1275">            model.addAttribute(&quot;conexion&quot;, con);</span>


<span class="nc" id="L1278">                String uri = &quot;http://&quot; + ip +&quot;:&quot;+ puerto+ &quot;/api/pedidos&quot;;</span>
<span class="nc" id="L1279">                url = uri; </span>
<span class="nc" id="L1280">                RestTemplate restTemplate = new RestTemplate();   </span>
<span class="nc" id="L1281">                ResponseEntity&lt;Telefono[]&gt; response = restTemplate.getForEntity(uri,Telefono[].class);</span>
<span class="nc" id="L1282">                Telefono[] employees = response.getBody();	  </span>
<span class="nc" id="L1283">                model.addAttribute(&quot;listaFD&quot;, employees); </span>

                /*
                final List&lt;Telefono&gt; listaDis = dao.listPedidoF();
            
                model.addAttribute(&quot;listaFD&quot;, listaDis);  

        
                */


        
            
<span class="nc" id="L1296">                return &quot;FabricaControl.html&quot;;</span>
        }
    



    
         /**
         * &lt;p&gt;Este controlador es para confirmar a fabrica  &lt;/p&gt;
         * @deprecated
         * usado solo para hacer pruebas con la api
         * @param model la representacion html 
         * @param n el telefono que se guardo   
         * @return la pagina a redireccionar 
      
        */ 
        @RequestMapping(value = &quot;/updateEstadp&quot;)
        public String updateP(final Model model,@ModelAttribute(&quot;nuevo&quot;) Telefono n)

        {       
        
<span class="nc" id="L1317">            String uri = &quot;http://&quot; + ip +&quot;:&quot;+ puerto+ &quot;/api/pedidos/6074b74053f92e0fb4017181&quot;;</span>
<span class="nc" id="L1318">            RestTemplate restTemplate = new RestTemplate();</span>

<span class="nc" id="L1320">		    Map&lt;String, String&gt; map = new HashMap&lt;&gt;();</span>
           
<span class="nc" id="L1322">            map.put(&quot;Estado&quot;, &quot;Entregado&quot;);         </span>
        

            
		
<span class="nc" id="L1327">		    return &quot;a &quot;; </span>
		
		  

        }




        @RequestMapping(value = &quot;/devolucion&quot;)
        public String devolucion(final Model model,@RequestParam(name=&quot;ip&quot;) String ips,@RequestParam(name=&quot;puerto&quot;) String puertos,@RequestParam(name=&quot;series&quot;) String series)

        {       
<span class="nc" id="L1340">            String conexion =  &quot;&quot; + ips +&quot;:&quot; + puertos; </span>
            
<span class="nc" id="L1342">            model.addAttribute(&quot;conexion&quot;,conexion);</span>
<span class="nc" id="L1343">            model.addAttribute(&quot;series&quot;,series);</span>

<span class="nc" id="L1345">            return &quot;terminalIndividual.html&quot;;</span>
           
        }




        @RequestMapping(value = &quot;/devolver&quot;)
        public String devolver(final Model model,@RequestParam(name=&quot;conexion&quot;) String conexion,@RequestParam(name=&quot;serie&quot;) String num_series)

        {       
        
<span class="nc" id="L1357">            String uri = &quot;http://&quot; + conexion+ &quot;/api/serie/&quot;+num_series;</span>
<span class="nc" id="L1358">            RestTemplate restTemplate = new RestTemplate();</span>
<span class="nc" id="L1359">		    Map&lt;String, String&gt; map = new HashMap&lt;&gt;();           </span>
<span class="nc" id="L1360">            map.put(&quot;estado&quot;, &quot;Devuelto&quot;);         </span>

            
		
<span class="nc" id="L1364">            restTemplate.put(uri, map);  </span>
		
		  

		  
        
            
<span class="nc" id="L1371">            return &quot;redirect:/terminales&quot;;</span>
        }

     




   









    

   








}

</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.6.202009150832</span></div></body></html>