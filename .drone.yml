kind: pipeline 

steps:

- name: Build-dev
  image: maven:3-jdk-11
  commands:  
    - mvn -f ventas/pom.xml -Pdev package
  when:
    branch:
      -DEV
- name: Build-uat
  image: maven:3-jdk-11
  commands:  
    - mvn -f ventas/pom.xml -Puat package
  when:
    branch:
      -UAT

- name: Build-prod
  image: maven:3-jdk-11
  commands:  
    - mvn -f ventas/pom.xml -Pprod package
  when:
    branch:
      -1PROD

- name: Build-main
  image: maven:3-jdk-11
  commands:  
    - mvn -f ventas/pom.xml -Pprod package
  when:
    branch:
      -main

     
      

- name: Servers-dev
  image: alpine
  commands:
    - ls
    - cd ventas/target
    - ls
    - apk add curl
    - mv  ventas-0.0.1-SNAPSHOT.war main.war
    - curl -v -u admin:admin -T main.war 'http://wzcvu06han7aiqu3qovyj5.webrelay.io/manager/text/deploy?path=/main-dev&update=true'
  when:
    branch:
      -DEV


- name: Servers-uat
  image: alpine
  commands:
    - ls
    - cd ventas/target
    - ls
    - apk add curl
    - mv  ventas-0.0.1-SNAPSHOT.war main.war
    - curl -v -u admin:admin -T main.war 'http://wzcvu06han7aiqu3qovyj5.webrelay.io/manager/text/deploy?path=/main-uat&update=true'
  when:
    branch:
      -UAT

- name: Servers-prod
  image: alpine
  commands:
    - ls
    - cd ventas/target
    - ls
    - apk add curl
    - mv  ventas-0.0.1-SNAPSHOT.war main.war
    - curl -v -u admin:admin -T main.war 'http://wzcvu06han7aiqu3qovyj5.webrelay.io/manager/text/deploy?path=/main-prod&update=true'
  when:
    branch:
      -1PROD
      
- name: Servers-main
  image: alpine
  commands:
    - ls
    - cd ventas/target
    - ls
    - apk add curl
    - mv  ventas-0.0.1-SNAPSHOT.war main.war
    - curl -v -u admin:admin -T main.war 'http://wzcvu06han7aiqu3qovyj5.webrelay.io/manager/text/deploy?path=/main-prodmain&update=true'
  when:
    branch:
      -main
 



    



- name: notify
  image: drillster/drone-email
  settings:
    from: chavarria181386@unis.edu.gt    
    host: smtp.sendgrid.net
    port: 465
    username:
       from_secret: emu1
    password: 
      from_secret: emu2    
    
    recipients:
        - gchavarriamunoz@gmail.com

  when:
    status:
    - success
    - failure
 

    
    
